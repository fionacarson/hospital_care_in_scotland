% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Investigating Data - Covid Wider Impacts},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Investigating Data - Covid Wider Impacts}
\author{}
\date{\vspace{-2.5em}}

\begin{document}
\maketitle

Looking at wider covid impacts data weekly variability - related to
2018/19 baseline

revised version - now extracting all Scotland more easily.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Attaching packages --------------------------------------- tidyverse 1.3.2 --
## v ggplot2 3.4.0      v purrr   0.3.5 
## v tibble  3.1.8      v dplyr   1.0.10
## v tidyr   1.2.1      v stringr 1.4.1 
## v readr   2.1.3      v forcats 0.5.2 
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(}\StringTok{"janitor"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'janitor'
## 
## The following objects are masked from 'package:stats':
## 
##     chisq.test, fisher.test
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(}\StringTok{"lubridate"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: timechange
## 
## Attaching package: 'lubridate'
## 
## The following objects are masked from 'package:base':
## 
##     date, intersect, setdiff, union
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(}\StringTok{"skimr"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(}\StringTok{"infer"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\#read in healthboard codes

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hb\_codes }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(here}\SpecialCharTok{::}\FunctionTok{here}\NormalTok{(}\StringTok{"lookup\_tables/health\_board\_codes.csv"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 20 Columns: 5
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (3): HB, HBName, Country
## dbl (2): HBDateEnacted, HBDateArchived
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hb\_codes }\OtherTok{\textless{}{-}} \FunctionTok{clean\_names}\NormalTok{(hb\_codes)}
\end{Highlighting}
\end{Shaded}

\#load in datafiles

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"Covid admissions by health board and speciality.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 55233 Columns: 11
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (6): HB, HBQF, AdmissionType, AdmissionTypeQF, Specialty, SpecialtyQF
## dbl (5): _id, WeekEnding, NumberAdmissions, Average20182019, PercentVariation
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\OtherTok{\textless{}{-}} \FunctionTok{clean\_names}\NormalTok{(weekly\_admissions\_spec)}

\NormalTok{weekly\_admissions\_dep }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"Covid admissions by health board and deprivation.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 30370 Columns: 10
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (4): HB, HBQF, AdmissionType, AdmissionTypeQF
## dbl (6): _id, WeekEnding, SIMDQuintile, NumberAdmissions, Average20182019, P...
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_dep }\OtherTok{\textless{}{-}} \FunctionTok{clean\_names}\NormalTok{(weekly\_admissions\_dep)}

\NormalTok{weekly\_admissions\_demog }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"Covid admissions by health board, age and sex.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 61951 Columns: 13
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## chr (8): HB, HBQF, AgeGroup, AgeGroupQF, Sex, SexQF, AdmissionType, Admissio...
## dbl (5): _id, WeekEnding, NumberAdmissions, Average20182019, PercentVariation
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_demog }\OtherTok{\textless{}{-}} \FunctionTok{clean\_names}\NormalTok{(weekly\_admissions\_demog)}
\end{Highlighting}
\end{Shaded}

data cleaning note probably more cleaning needed before we finalise I
changed the spelling but it turns out both spellings are correct!

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\OtherTok{\textless{}{-}}\NormalTok{ weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{rename}\NormalTok{(}\StringTok{"speciality"}\OtherTok{=} \StringTok{"specialty"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{rename}\NormalTok{(}\StringTok{"speciality\_qf"}\OtherTok{=} \StringTok{"specialty\_qf"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\hypertarget{merge-hbnames-into-datafiles}{%
\section{merge hbnames into
datafiles}\label{merge-hbnames-into-datafiles}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(weekly\_admissions\_spec,hb\_codes)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Joining, by = "hb"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_demog }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(weekly\_admissions\_demog,hb\_codes)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Joining, by = "hb"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_dep }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(weekly\_admissions\_dep,hb\_codes) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Joining, by = "hb"
\end{verbatim}

\#do the analysis needed for identifying winter and `crisis'

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{distinct}\NormalTok{(hb\_name)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 16 x 1
##    hb_name                      
##    <chr>                        
##  1 NHS Ayrshire and Arran       
##  2 NHS Borders                  
##  3 NHS Dumfries and Galloway    
##  4 NHS Forth Valley             
##  5 NHS Grampian                 
##  6 NHS Highland                 
##  7 NHS Lothian                  
##  8 NHS Orkney                   
##  9 NHS Shetland                 
## 10 NHS Western Isles            
## 11 NHS Fife                     
## 12 NHS Tayside                  
## 13 NHS Greater Glasgow and Clyde
## 14 NHS Lanarkshire              
## 15 All Scotland                 
## 16 <NA>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{skim}\NormalTok{(weekly\_admissions\_spec)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ll@{}}
\caption{Data summary}\tabularnewline
\toprule()
\endhead
Name & weekly\_admissions\_spec \\
Number of rows & 55233 \\
Number of columns & 15 \\
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ & \\
Column type frequency: & \\
character & 8 \\
numeric & 7 \\
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ & \\
Group variables & None \\
\bottomrule()
\end{longtable}

\textbf{Variable type: character}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.2368}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1316}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1842}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0526}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0526}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.0789}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1184}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 14\tabcolsep) * \real{0.1447}}@{}}
\toprule()
\begin{minipage}[b]{\linewidth}\raggedright
skim\_variable
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_missing
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
complete\_rate
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
min
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
max
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
empty
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_unique
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
whitespace
\end{minipage} \\
\midrule()
\endhead
hb & 1695 & 0.97 & 9 & 9 & 0 & 15 & 0 \\
hbqf & 49452 & 0.10 & 1 & 1 & 0 & 1 & 0 \\
admission\_type & 0 & 1.00 & 3 & 9 & 0 & 3 & 0 \\
admission\_type\_qf & 34544 & 0.37 & 1 & 1 & 0 & 1 & 0 \\
speciality & 882 & 0.98 & 3 & 35 & 0 & 12 & 0 \\
speciality\_qf & 48154 & 0.13 & 1 & 1 & 0 & 1 & 0 \\
hb\_name & 1695 & 0.97 & 8 & 29 & 0 & 15 & 0 \\
country & 1695 & 0.97 & 9 & 9 & 0 & 1 & 0 \\
\bottomrule()
\end{longtable}

\textbf{Variable type: numeric}

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.1475}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0820}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.1148}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0984}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0738}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0902}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0902}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0902}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0738}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0902}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 20\tabcolsep) * \real{0.0492}}@{}}
\toprule()
\begin{minipage}[b]{\linewidth}\raggedright
skim\_variable
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
n\_missing
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
complete\_rate
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
mean
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
sd
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p0
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p25
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p50
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p75
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
p100
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
hist
\end{minipage} \\
\midrule()
\endhead
id & 0 & 1.00 & 27617.00 & 15944.54 & 1.0 & 13809.0 & 27617.0 & 41425 &
55233.0 & ▇▇▇▇▇ \\
week\_ending & 0 & 1.00 & 20210402.53 & 8084.38 & 20200105.0 &
20200927.0 & 20210620.0 & 20220313 & 20221127.0 & ▇▁▇▁▇ \\
number\_admissions & 0 & 1.00 & 389.48 & 1205.61 & 5.0 & 21.0 & 70.0 &
264 & 15726.0 & ▇▁▁▁▁ \\
average20182019 & 0 & 1.00 & 444.10 & 1350.27 & 0.0 & 25.5 & 84.0 & 305
& 16501.5 & ▇▁▁▁▁ \\
percent\_variation & 0 & 1.00 & 5.84 & 272.84 & -95.9 & -28.6 & -11.8 &
4 & 8000.0 & ▇▁▁▁▁ \\
hb\_date\_enacted & 7476 & 0.86 & 20156434.39 & 21800.83 & 20140401.0 &
20140401.0 & 20140401.0 & 20180202 & 20190401.0 & ▇▁▁▂▂ \\
hb\_date\_archived & 55233 & 0.00 & NaN & NA & NA & NA & NA & NA & NA
& \\
\bottomrule()
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_demog }\OtherTok{\textless{}{-}}\NormalTok{ weekly\_admissions\_demog }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =} \FunctionTok{as.integer}\NormalTok{(}\FunctionTok{str\_sub}\NormalTok{(week\_ending,}\DecValTok{1}\NormalTok{,}\DecValTok{4}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{month =} \FunctionTok{as.integer}\NormalTok{(}\FunctionTok{str\_sub}\NormalTok{(week\_ending,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{day =} \FunctionTok{as.integer}\NormalTok{(}\FunctionTok{str\_sub}\NormalTok{(week\_ending,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{wdate =} \FunctionTok{ymd}\NormalTok{(week\_ending)) }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\# identify "All Scotland" data}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{hb\_name =} \FunctionTok{ifelse}\NormalTok{(hb}\SpecialCharTok{==}\StringTok{"S92000003"}\NormalTok{,}\StringTok{"All Scotland"}\NormalTok{,hb\_name)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{hb\_name =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(hb\_name),}\StringTok{"NHS Region Unknown"}\NormalTok{,hb\_name)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{iswinter =} \FunctionTok{ifelse}\NormalTok{(month }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{9}\NormalTok{),}\ConstantTok{FALSE}\NormalTok{,}\ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{above\_thresh =} \FunctionTok{ifelse}\NormalTok{(percent\_variation}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{0}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\OtherTok{\textless{}{-}}\NormalTok{ weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =} \FunctionTok{as.integer}\NormalTok{(}\FunctionTok{str\_sub}\NormalTok{(week\_ending,}\DecValTok{1}\NormalTok{,}\DecValTok{4}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{month =} \FunctionTok{as.integer}\NormalTok{(}\FunctionTok{str\_sub}\NormalTok{(week\_ending,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{day =} \FunctionTok{as.integer}\NormalTok{(}\FunctionTok{str\_sub}\NormalTok{(week\_ending,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{wdate =} \FunctionTok{ymd}\NormalTok{(week\_ending)) }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\# identify "All Scotland" data}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{hb\_name =} \FunctionTok{ifelse}\NormalTok{(hb}\SpecialCharTok{==}\StringTok{"S92000003"}\NormalTok{,}\StringTok{"All Scotland"}\NormalTok{,hb\_name)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{hb\_name =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(hb\_name),}\StringTok{"NHS Region Unknown"}\NormalTok{,hb\_name)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{iswinter =} \FunctionTok{ifelse}\NormalTok{(month }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{9}\NormalTok{),}\ConstantTok{FALSE}\NormalTok{,}\ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{above\_thresh =} \FunctionTok{ifelse}\NormalTok{(percent\_variation}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{0}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_admissions\_spec }\OtherTok{\textless{}{-}}\NormalTok{ weekly\_admissions\_spec}

\NormalTok{monthly\_admissions\_spec }\OtherTok{\textless{}{-}}\NormalTok{ monthly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(hb, admission\_type, speciality, year, month) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{monthly\_admissions =} \DecValTok{4}\SpecialCharTok{*}\FunctionTok{mean}\NormalTok{(number\_admissions, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{mdate =} \FunctionTok{as.Date}\NormalTok{(}\FunctionTok{make\_datetime}\NormalTok{(year, month, }\DecValTok{15}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ungroup}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'hb', 'admission_type', 'speciality',
## 'year'. You can override using the `.groups` argument.
\end{verbatim}

\#merge hbnames into datafiles

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_admissions\_spec }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(monthly\_admissions\_spec,hb\_codes)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Joining, by = "hb"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#monthly\_admissions\_demog \textless{}{-} left\_join(monthly\_admissions\_demog,hb\_codes)}
\CommentTok{\#monthly\_admissions\_dep \textless{}{-} left\_join(monthly\_admissions\_dep,hb\_codes) }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_admissions\_spec }\OtherTok{\textless{}{-}}\NormalTok{ monthly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{hb\_name =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(hb\_name),}\StringTok{"NHS Region Unknown"}\NormalTok{,hb\_name)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{iswinter =} \FunctionTok{ifelse}\NormalTok{(month }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{9}\NormalTok{),}\ConstantTok{FALSE}\NormalTok{,}\ConstantTok{TRUE}\NormalTok{)) }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ number\_admissions) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{colour=}\StringTok{\textquotesingle{}red\textquotesingle{}}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-13-1.pdf}
check results

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_admissions\_spec}\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{mdate, }\AttributeTok{y =}\NormalTok{ monthly\_admissions) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{colour=}\StringTok{\textquotesingle{}red\textquotesingle{}}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-14-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{monthly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{filter}\NormalTok{(year }\SpecialCharTok{==} \DecValTok{2021}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{filter}\NormalTok{(month}\SpecialCharTok{==}\DecValTok{8}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 12
##   hb      admis~1 speci~2  year month month~3 mdate      hb_name hb_da~4 hb_da~5
##   <chr>   <chr>   <chr>   <int> <int>   <dbl> <date>     <chr>     <dbl>   <dbl>
## 1 S92000~ All     All      2021     8  56210. 2021-08-15 All Sc~      NA      NA
## # ... with 2 more variables: country <chr>, iswinter <lgl>, and abbreviated
## #   variable names 1: admission_type, 2: speciality, 3: monthly_admissions,
## #   4: hb_date_enacted, 5: hb_date_archived
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(slider)}

\NormalTok{data\_rolling }\OtherTok{\textless{}{-}}\NormalTok{ weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(wdate }\SpecialCharTok{\textgreater{}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2020{-}05{-}01"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}  
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{moving\_avg =} \FunctionTok{slide\_dbl}\NormalTok{(}
      \AttributeTok{.x =}\NormalTok{ number\_admissions, }
      \AttributeTok{.f =} \SpecialCharTok{\textasciitilde{}} \FunctionTok{mean}\NormalTok{(., }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
      \AttributeTok{.before =} \DecValTok{12}\NormalTok{,}
      \AttributeTok{.after =} \DecValTok{12}\NormalTok{,}
      \AttributeTok{.complete =} \ConstantTok{FALSE}
\NormalTok{    )}
\NormalTok{  )}
\NormalTok{data\_rolling}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 135 x 22
##       id week_ending hb    hbqf  admis~1 admis~2 speci~3 speci~4 numbe~5 avera~6
##    <dbl>       <dbl> <chr> <chr> <chr>   <chr>   <chr>   <chr>     <dbl>   <dbl>
##  1  2416    20200503 S920~ d     All     d       All     d         10422  15608.
##  2  2548    20200510 S920~ d     All     d       All     d         10363  15114.
##  3  2682    20200517 S920~ d     All     d       All     d         10510  15783 
##  4  2815    20200524 S920~ d     All     d       All     d         10987  15634.
##  5  2953    20200531 S920~ d     All     d       All     d         11008  15458.
##  6  3088    20200607 S920~ d     All     d       All     d         11792  15490.
##  7  3221    20200614 S920~ d     All     d       All     d         11619  15508.
##  8  3357    20200621 S920~ d     All     d       All     d         12217  15556 
##  9  3493    20200628 S920~ d     All     d       All     d         12358  15455 
## 10  3633    20200705 S920~ d     All     d       All     d         12034  15082.
## # ... with 125 more rows, 12 more variables: percent_variation <dbl>,
## #   hb_name <chr>, hb_date_enacted <dbl>, hb_date_archived <dbl>,
## #   country <chr>, year <int>, month <int>, day <int>, wdate <date>,
## #   iswinter <lgl>, above_thresh <dbl>, moving_avg <dbl>, and abbreviated
## #   variable names 1: admission_type, 2: admission_type_qf, 3: speciality,
## #   4: speciality_qf, 5: number_admissions, 6: average20182019
\end{verbatim}

\#calculate difference to create mvar

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_rolling }\OtherTok{\textless{}{-}}\NormalTok{ data\_rolling }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{mvar =}\NormalTok{ number\_admissions}\SpecialCharTok{{-}}\NormalTok{ moving\_avg)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plot---check-the-smoother-makes-sense-and-tweak-values-if-they-dont}{%
\section{plot - check the smoother makes sense and tweak values if they
dont}\label{plot---check-the-smoother-makes-sense-and-tweak-values-if-they-dont}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(data\_rolling)}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ wdate, }\AttributeTok{y =}\NormalTok{ number\_admissions), }\AttributeTok{colour =} \StringTok{"gray"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ wdate, }\AttributeTok{y =}\NormalTok{ moving\_avg), }\AttributeTok{colour =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ wdate, }\AttributeTok{y =}\NormalTok{ mvar), }\AttributeTok{colour =} \StringTok{"green"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-18-1.pdf}

\#now create a boxplot

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_rolling }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{iswinter, }\AttributeTok{y=}\NormalTok{mvar) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-19-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_rolling }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(iswinter) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mvar) }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{col =} \StringTok{"white"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
\end{verbatim}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-20-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{seasonal\_avg }\OtherTok{\textless{}{-}}\NormalTok{ data\_rolling }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(iswinter) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{mean=} \FunctionTok{mean}\NormalTok{(mvar, }\AttributeTok{na.rm=}\ConstantTok{TRUE}\NormalTok{))}
\NormalTok{seasonal\_avg}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 2
##   iswinter   mean
##   <lgl>     <dbl>
## 1 FALSE      6.04
## 2 TRUE     -38.3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_dep }\OtherTok{\textless{}{-}}\NormalTok{ weekly\_admissions\_dep }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year =} \FunctionTok{as.integer}\NormalTok{(}\FunctionTok{str\_sub}\NormalTok{(week\_ending,}\DecValTok{1}\NormalTok{,}\DecValTok{4}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{month =} \FunctionTok{as.integer}\NormalTok{(}\FunctionTok{str\_sub}\NormalTok{(week\_ending,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{day =} \FunctionTok{as.integer}\NormalTok{(}\FunctionTok{str\_sub}\NormalTok{(week\_ending,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{wdate =} \FunctionTok{ymd}\NormalTok{(week\_ending)) }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\# identify "All Scotland" data}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{hb\_name =} \FunctionTok{ifelse}\NormalTok{(hb}\SpecialCharTok{==}\StringTok{"S92000003"}\NormalTok{,}\StringTok{"All Scotland"}\NormalTok{,hb\_name)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{hb\_name =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(hb\_name),}\StringTok{"NHS Region Unknown"}\NormalTok{,hb\_name)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{iswinter =} \FunctionTok{ifelse}\NormalTok{(month }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{9}\NormalTok{),}\ConstantTok{FALSE}\NormalTok{,}\ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{above\_thresh =} \FunctionTok{ifelse}\NormalTok{(percent\_variation}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{0}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

take a look at what is in each dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{distinct}\NormalTok{(hb\_name)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 16 x 1
##    hb_name                      
##    <chr>                        
##  1 NHS Ayrshire and Arran       
##  2 NHS Borders                  
##  3 NHS Dumfries and Galloway    
##  4 NHS Forth Valley             
##  5 NHS Grampian                 
##  6 NHS Highland                 
##  7 NHS Lothian                  
##  8 NHS Orkney                   
##  9 NHS Shetland                 
## 10 NHS Western Isles            
## 11 NHS Fife                     
## 12 NHS Tayside                  
## 13 NHS Greater Glasgow and Clyde
## 14 NHS Lanarkshire              
## 15 All Scotland                 
## 16 NHS Region Unknown
\end{verbatim}

14 health boards plus `all scotland' and an NA - need to work out what
to do with this

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{distinct}\NormalTok{(admission\_type)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 1
##   admission_type
##   <chr>         
## 1 All           
## 2 Emergency     
## 3 Planned
\end{verbatim}

Data neatly divided into emergency and planned

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{distinct}\NormalTok{(speciality)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 13 x 1
##    speciality                         
##    <chr>                              
##  1 Accident & Emergency               
##  2 All                                
##  3 Cardiology                         
##  4 Medical (excl. Cardiology & Cancer)
##  5 Medical (incl. Cardiology & Cancer)
##  6 Paediatrics (medical & surgical)   
##  7 Paediatrics (medical)              
##  8 Surgery                            
##  9 Community                          
## 10 Gynaecology                        
## 11 Cancer                             
## 12 Paediatrics (surgical)             
## 13 <NA>
\end{verbatim}

note that some groupings are also combined. need to take a closer look
at what these mean.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_demog }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{distinct}\NormalTok{(age\_group)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 8 x 1
##   age_group  
##   <chr>      
## 1 Under 5    
## 2 5 - 14     
## 3 15 - 44    
## 4 45 - 64    
## 5 65 - 74    
## 6 75 - 84    
## 7 85 and over
## 8 All ages
\end{verbatim}

7 age groups and ``all ages''

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_demog }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{distinct}\NormalTok{(sex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 1
##   sex   
##   <chr> 
## 1 All   
## 2 Female
## 3 Male
\end{verbatim}

just male - female and all

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_dep }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{distinct}\NormalTok{(simd\_quintile)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 1
##   simd_quintile
##           <dbl>
## 1             1
## 2             2
## 3             3
## 4             4
## 5             5
\end{verbatim}

note there is no `all' category in this dataset

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ number\_admissions) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{colour=}\StringTok{\textquotesingle{}red\textquotesingle{}}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-29-1.pdf}
same graph as above!

weekly hospital admissions hover around 14000 per week expect 168,000
per quarter?

pre=pandemic hospital admissions hovered around 15500 per week expect
186,000 per quarter

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ percent\_variation) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{colour=}\StringTok{\textquotesingle{}red\textquotesingle{}}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-30-1.pdf}

Overall(all specialities, all admissions, all healthboards) admissions
are only at 90\% of pre-pandemic levels

quick look at demographics

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_demog }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(sex }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(age\_group }\SpecialCharTok{!=} \StringTok{"All ages"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ number\_admissions, }\AttributeTok{color =}\NormalTok{ age\_group) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{() }\CommentTok{\#+}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-31-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#scale\_colour\_brewer(palette = "Set2") }
\end{Highlighting}
\end{Shaded}

age plot shows some variation between age groups.

quick look at sex differences

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_demog }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(sex }\SpecialCharTok{!=} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(age\_group }\SpecialCharTok{==} \StringTok{"All ages"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ percent\_variation, }\AttributeTok{color =}\NormalTok{ sex) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{() }\CommentTok{\#+}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-32-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#scale\_colour\_brewer(palette = "Set2") }
\end{Highlighting}
\end{Shaded}

quick look at index of deprivation. 1 is most deprived and 5 is least
deprived

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_dep }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ percent\_variation, }\AttributeTok{color =} \FunctionTok{as.factor}\NormalTok{(simd\_quintile)) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-33-1.pdf}
something happening in 2022 - why is there divergence between 1 and 5?

look at admissions type

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{!=} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{==}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ percent\_variation, }\AttributeTok{colour =}\NormalTok{ admission\_type) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-34-1.pdf}
need to check what the `spike' in planned at end of 2021 is related to

quick look at specialities

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{!=}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ percent\_variation, }\AttributeTok{colour=}\NormalTok{speciality) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-35-1.pdf}
take a closer look at paediatrics

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{!=}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(speciality,}\StringTok{"Paed"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ number\_admissions, }\AttributeTok{colour=}\NormalTok{speciality) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-36-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{!=}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(speciality,}\StringTok{"Paed"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ percent\_variation, }\AttributeTok{colour=}\NormalTok{speciality) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-37-1.pdf}
take a closer look at medical

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{!=}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(speciality,}\StringTok{"Medical"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ percent\_variation, }\AttributeTok{colour=}\NormalTok{speciality) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-38-1.pdf}
simpler plot of specialities

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"Planned"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{!=}\StringTok{"Medical (incl. Cardiology \& Cancer)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{str\_detect}\NormalTok{(speciality,}\StringTok{"Paed"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{!=}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{!=}\StringTok{"Accident \& Emergency"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ percent\_variation, }\AttributeTok{colour=}\NormalTok{speciality) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{scale\_colour\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set1"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-39-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"Emergency"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{!=}\StringTok{"Medical (incl. Cardiology \& Cancer)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{str\_detect}\NormalTok{(speciality,}\StringTok{"Paed"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{!=}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{!=}\StringTok{"Accident \& Emergency"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{==}\StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ percent\_variation, }\AttributeTok{colour=}\NormalTok{speciality) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{scale\_colour\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set1"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-40-1.pdf}
boxplot for different specialities? some values greater than 8000\% (i
have filtered them out ) indicates we need some more work on data
cleaning!

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\#filter(admission\_type == "All") \%\textgreater{}\% }
  \CommentTok{\#filter(speciality!="All") \%\textgreater{}\% }
  \CommentTok{\#filter(hb\_name =="NHS Region Unknown") \%\textgreater{}\% }
  \CommentTok{\#group\_by(speciality) \%\textgreater{}\% }
  \CommentTok{\#need to take a good look at what these values are!}
  \FunctionTok{filter}\NormalTok{(percent\_variation}\SpecialCharTok{\textgreater{}}\DecValTok{500}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 230 x 21
##       id week_ending hb    hbqf  admis~1 admis~2 speci~3 speci~4 numbe~5 avera~6
##    <dbl>       <dbl> <chr> <chr> <chr>   <chr>   <chr>   <chr>     <dbl>   <dbl>
##  1   325    20200119 S080~ <NA>  All     d       Accide~ <NA>        263    27.5
##  2  3429    20200628 S080~ <NA>  All     d       Commun~ <NA>          5     0  
##  3  3507    20200628 <NA>  <NA>  All     d       Gynaec~ <NA>          5     0  
##  4  3570    20200705 S080~ <NA>  All     d       Commun~ <NA>          5     0  
##  5  3977    20200726 S080~ <NA>  All     d       Commun~ <NA>          8     0  
##  6  4118    20200802 S080~ <NA>  All     d       Commun~ <NA>          8     0  
##  7  4255    20200809 S080~ <NA>  All     d       Commun~ <NA>          9     0  
##  8  4333    20200809 <NA>  <NA>  All     d       Gynaec~ <NA>          5     0  
##  9  4396    20200816 S080~ <NA>  All     d       Commun~ <NA>          7     0  
## 10  4535    20200823 S080~ <NA>  All     d       Commun~ <NA>          6     0  
## # ... with 220 more rows, 11 more variables: percent_variation <dbl>,
## #   hb_name <chr>, hb_date_enacted <dbl>, hb_date_archived <dbl>,
## #   country <chr>, year <int>, month <int>, day <int>, wdate <date>,
## #   iswinter <lgl>, above_thresh <dbl>, and abbreviated variable names
## #   1: admission_type, 2: admission_type_qf, 3: speciality, 4: speciality_qf,
## #   5: number_admissions, 6: average20182019
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{!=}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(speciality) }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\#need to take a good look at what these values are!}
  \FunctionTok{filter}\NormalTok{(percent\_variation}\SpecialCharTok{\textless{}}\DecValTok{8000}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{speciality, }\AttributeTok{y=}\NormalTok{percent\_variation)}\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-42-1.pdf}
some specialities have faced higher admission levels than others.

Now look by health boards

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{==}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(hb\_name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y=}\NormalTok{percent\_variation, }\AttributeTok{colour =}\NormalTok{ hb\_name)}\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-43-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{==}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(hb\_name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{hb\_name, }\AttributeTok{y=}\NormalTok{percent\_variation)}\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-44-1.pdf}

for some health boards a significant number of admissions levels are
above the levels seen in 2018-19. could we parhaps try and use this as
an indicator?

Need to think more carefully about what the data in `region unknown'
means

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{==}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y=}\NormalTok{percent\_variation, }\AttributeTok{colour=}\NormalTok{hb\_name) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{hb\_name)}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-45-1.pdf}
How is NA calculated - still need to check??

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{!=} \StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(hb\_name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{mean =} \FunctionTok{mean}\NormalTok{(number\_admissions)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(mean))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 15 x 2
##    hb_name                         mean
##    <chr>                          <dbl>
##  1 NHS Greater Glasgow and Clyde 3522. 
##  2 NHS Lothian                   2052. 
##  3 NHS Lanarkshire               1468. 
##  4 NHS Grampian                  1170. 
##  5 NHS Tayside                   1154. 
##  6 NHS Ayrshire and Arran         932. 
##  7 NHS Fife                       849. 
##  8 NHS Forth Valley               721. 
##  9 NHS Highland                   679. 
## 10 NHS Dumfries and Galloway      367. 
## 11 NHS Borders                    210. 
## 12 NHS Region Unknown             186. 
## 13 NHS Western Isles               63.8
## 14 NHS Shetland                    36.6
## 15 NHS Orkney                      36.5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(hb\_name }\SpecialCharTok{!=} \StringTok{"All Scotland"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{wdate, }\AttributeTok{y =}\NormalTok{ number\_admissions, }\AttributeTok{colour =}\NormalTok{ hb\_name) }\SpecialCharTok{+}
\FunctionTok{geom\_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-47-1.pdf}
admission values shows all health boards - health boards vary massively
in size and admission numbers but mostly same overall pattern.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{==}\StringTok{"Accident \& Emergency"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\#take a good look at what these values are!}
  \FunctionTok{filter}\NormalTok{(percent\_variation}\SpecialCharTok{\textless{}}\DecValTok{8000}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(hb\_name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{hb\_name, }\AttributeTok{y=}\NormalTok{percent\_variation)}\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-48-1.pdf}
do only certain health boards have an A+E dept?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"Emergency"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\#filter(speciality=="Accident \& Emergency") \%\textgreater{}\% }
  \CommentTok{\#take a good look at what these values are!}
  \FunctionTok{filter}\NormalTok{(percent\_variation}\SpecialCharTok{\textless{}}\DecValTok{8000}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(hb\_name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{hb\_name, }\AttributeTok{y=}\NormalTok{percent\_variation)}\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-49-1.pdf}

first attempt at a `crisis' calculation

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==} \StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{==}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\#filter(admission\_type =="Emergency") \%\textgreater{}\% }
  \CommentTok{\#filter(speciality=="Accident \& Emergency") \%\textgreater{}\% }
  \CommentTok{\#filter(year == 2020) \%\textgreater{}\% }
  \FunctionTok{filter}\NormalTok{(iswinter) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(hb\_name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{count\_bad\_days =} \FunctionTok{sum}\NormalTok{(above\_thresh), }
            \AttributeTok{count\_days =} \FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{, }
            \AttributeTok{pcnt\_bad\_days =} \DecValTok{100}\SpecialCharTok{*}\NormalTok{(}\FunctionTok{sum}\NormalTok{(above\_thresh)}\SpecialCharTok{/}\NormalTok{(}\FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{)), }
            \AttributeTok{mean\_percentvar =}\FunctionTok{mean}\NormalTok{(percent\_variation)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{hb\_name, }\AttributeTok{y=}\NormalTok{mean\_percentvar) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-50-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{==}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\#filter(year == 2021) \%\textgreater{}\% }
  \CommentTok{\#filter(iswinter) \%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(hb\_name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{count\_bad\_days =} \FunctionTok{sum}\NormalTok{(above\_thresh), }
            \AttributeTok{count\_days =} \FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{, }
            \AttributeTok{pcnt\_bad\_days =} \DecValTok{100}\SpecialCharTok{*}\NormalTok{(}\FunctionTok{sum}\NormalTok{(above\_thresh)}\SpecialCharTok{/}\NormalTok{(}\FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{)), }
            \AttributeTok{mean\_percentvar =}\FunctionTok{mean}\NormalTok{(percent\_variation)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{hb\_name, }\AttributeTok{y=}\NormalTok{pcnt\_bad\_days) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-51-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{==}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==}\StringTok{"Emergency"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\#filter(speciality=="Accident \& Emergency") \%\textgreater{}\% }
  \CommentTok{\#filter(year == 2020) \%\textgreater{}\% }
  \FunctionTok{filter}\NormalTok{(iswinter) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(hb\_name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{count\_bad\_days =} \FunctionTok{sum}\NormalTok{(above\_thresh), }
            \AttributeTok{count\_days =} \FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{, }
            \AttributeTok{pcnt\_bad\_days =} \DecValTok{100}\SpecialCharTok{*}\NormalTok{(}\FunctionTok{sum}\NormalTok{(above\_thresh)}\SpecialCharTok{/}\NormalTok{(}\FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{)), }
            \AttributeTok{mean\_percentvar =}\FunctionTok{mean}\NormalTok{(percent\_variation)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{hb\_name, }\AttributeTok{y=}\NormalTok{pcnt\_bad\_days) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-52-1.pdf}
take a look by health board

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{==}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==}\StringTok{"Emergency"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\#filter(speciality=="Accident \& Emergency") \%\textgreater{}\% }
  \CommentTok{\#filter(year == 2020) \%\textgreater{}\% }
  \CommentTok{\#filter(iswinter) \%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(hb\_name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{count\_bad\_days =} \FunctionTok{sum}\NormalTok{(above\_thresh), }
            \AttributeTok{count\_days =} \FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{, }
            \AttributeTok{pcnt\_bad\_days =} \DecValTok{100}\SpecialCharTok{*}\NormalTok{(}\FunctionTok{sum}\NormalTok{(above\_thresh)}\SpecialCharTok{/}\NormalTok{(}\FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{)), }
            \AttributeTok{mean\_percentvar =}\FunctionTok{mean}\NormalTok{(percent\_variation)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{hb\_name, }\AttributeTok{y=}\NormalTok{pcnt\_bad\_days) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-53-1.pdf}

quick look at winter v summer

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{==}\StringTok{"Accident \& Emergency"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(iswinter, year) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{pcnt\_bad\_days =} \FunctionTok{sum}\NormalTok{(above\_thresh)}\SpecialCharTok{/}\FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{, }\AttributeTok{mean\_percentvar =}\FunctionTok{mean}\NormalTok{(percent\_variation)) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'iswinter'. You can override using the
## `.groups` argument.
\end{verbatim}

\begin{verbatim}
## # A tibble: 6 x 4
## # Groups:   iswinter [2]
##   iswinter  year pcnt_bad_days mean_percentvar
##   <lgl>    <int>         <dbl>           <dbl>
## 1 FALSE     2020          21.4            1.35
## 2 FALSE     2021          28.1           17.6 
## 3 FALSE     2022          19.1          -13.1 
## 4 TRUE      2020          28.3           43.7 
## 5 TRUE      2021          25.0           14.4 
## 6 TRUE      2022          21.1            2.10
\end{verbatim}

no obvious big discrepancy in winter admissions for this parameter
winters of 2020 and 2022 are `worse' than summers, percentages are small
and maybe not significant?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{==}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(iswinter, year) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{count\_bad\_days =} \FunctionTok{sum}\NormalTok{(above\_thresh), }
            \AttributeTok{count\_days =} \FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{, }
            \AttributeTok{pcnt\_bad\_days =} \DecValTok{100}\SpecialCharTok{*}\NormalTok{(}\FunctionTok{sum}\NormalTok{(above\_thresh)}\SpecialCharTok{/}\NormalTok{(}\FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{)), }
            \AttributeTok{mean\_percentvar =}\FunctionTok{mean}\NormalTok{(percent\_variation)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{iswinter, }\AttributeTok{y=}\NormalTok{pcnt\_bad\_days) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{facet\_grid}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{year)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'iswinter'. You can override using the
## `.groups` argument.
\end{verbatim}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-55-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{==}\StringTok{"All"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==}\StringTok{"Emergency"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(iswinter, year) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{count\_bad\_days =} \FunctionTok{sum}\NormalTok{(above\_thresh), }
            \AttributeTok{count\_days =} \FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{, }
            \AttributeTok{pcnt\_bad\_days =} \DecValTok{100}\SpecialCharTok{*}\NormalTok{(}\FunctionTok{sum}\NormalTok{(above\_thresh)}\SpecialCharTok{/}\NormalTok{(}\FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{)), }
            \AttributeTok{mean\_percentvar =}\FunctionTok{mean}\NormalTok{(percent\_variation)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{iswinter, }\AttributeTok{y=}\NormalTok{pcnt\_bad\_days) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{facet\_grid}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{year)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'iswinter'. You can override using the
## `.groups` argument.
\end{verbatim}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-56-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{weekly\_admissions\_spec }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(speciality}\SpecialCharTok{==}\StringTok{"Accident \& Emergency"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(admission\_type }\SpecialCharTok{==}\StringTok{"Emergency"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(iswinter, year) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{count\_bad\_days =} \FunctionTok{sum}\NormalTok{(above\_thresh), }
            \AttributeTok{count\_days =} \FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{, }
            \AttributeTok{pcnt\_bad\_days =} \DecValTok{100}\SpecialCharTok{*}\NormalTok{(}\FunctionTok{sum}\NormalTok{(above\_thresh)}\SpecialCharTok{/}\NormalTok{(}\FunctionTok{n}\NormalTok{()}\SpecialCharTok{*}\DecValTok{7}\NormalTok{)), }
            \AttributeTok{mean\_percentvar =}\FunctionTok{mean}\NormalTok{(percent\_variation)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{year, }\AttributeTok{y=}\NormalTok{pcnt\_bad\_days) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{facet\_grid}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{iswinter)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'iswinter'. You can override using the
## `.groups` argument.
\end{verbatim}

\includegraphics{investigating_data2_files/figure-latex/unnamed-chunk-57-1.pdf}

\end{document}
